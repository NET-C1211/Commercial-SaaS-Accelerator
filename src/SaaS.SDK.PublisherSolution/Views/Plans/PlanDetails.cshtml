@using Microsoft.Marketplace.SaasKit.Models;
@using Microsoft.Marketplace.SaasKit.Client.DataAccess.Entities;
@model PlansModel

<div class="text-center">
    <div>
        <div>
            <div class="nav-scroller bg-white shadow-sm ">
                <nav class="container pb-3 nav nav-underline">
                    <a class="nav-link active">
                        <a class="nav-link" id="Attributes" onclick="toggleActions('Attributes','Events')">Attributes</a>
                        <a class="nav-link" id="Events" onclick="toggleActions('Events','Attributes')">Events</a>
                    </a>
                </nav>
            </div>
        </div>
    </div>
    <form method="post" id="frmPlanEvents" asp-action="PlanDetails" asp-controller="Plans">
        <div class="container">
            <div class="card card-header">
                <input type='hidden' id='offerID' name='offerID' value="@Model.offerID" />
                <input type='hidden' id='PlanGUID' name='PlanGUID' value="@Model.PlanGUID" />
                <input type='hidden' id='Id' name='Id' value="@Model.Id" />
                <dl class="row">
                    <dt class="col-2 text-right"><b>Offer Name</b></dt>
                    <dd class="col-3 text-left">@Model.OfferName</dd>
                    <dt class="col-3 text-right"><b>Plan name</b></dt>
                    <dd class="col-4 text-left">@Model.DisplayName</dd>
                </dl>
            </div>
            <div id="PlanAttributes">
                @if (Model.PlanAttributes != null && Model.PlanAttributes.Count() > 0)
                {
                    <table class="table table-bordered dt-responsive cm-table" id="tblcontainer">
                        <theader>
                            <tr>
                                <th>DisplayName</th>
                                <th>Enable</th>
                            </tr>
                        </theader>

                        @for (int i = 0; i < Model.PlanAttributes.Count(); i++)
                        {
                            <tbody id="ReplacingTable">

                                <tr id="tr_PlanAttributes_@i">
                                    <td>
                                        <input id="PlanAttributes[@i].PlanAttributeId" type="hidden" value="@Model.PlanAttributes[i].PlanAttributeId" class="iHidden" name="PlanAttributes[@i].PlanAttributeId" />
                                        <input id="PlanAttributes[@i].OfferAttributeId" type="hidden" value="@Model.PlanAttributes[i].OfferAttributeId" class="iHidden" name="PlanAttributes[@i].OfferAttributeId" />
                                        <input id="PlanAttributes[@i].PlanId" type="hidden" value="@Model.PlanAttributes[i].PlanId" class="iHidden" name="PlanAttributes[@i].PlanId" />
                                        @Model.PlanAttributes[i].DisplayName
                                    </td>
                                    <td>
                                        @*<input type="checkbox" id="PlanAttributes[@i].IsEnabled" name="OfferAttributes[@i].IsEnabled" value="@Model.PlanAttributes[i].IsEnabled" />*@
                                        @Html.CheckBoxFor(model => model.PlanAttributes[i].IsEnabled, new { name = "PlanAttributes[@i].IsEnabled", id = string.Format("PlanAttributes_IsEnabled_{0}", @i) })
                                    </td>
                                </tr>

                            </tbody>
                        }
                    </table>
                }
                <div>
                    <p>
                        <input class="cm-button-default mt0" type="submit" value="Save Parameters" />
                    </p>
                </div>
            </div>
            <div id="PlanEvents" style="display:none">
                @if (Model.PlanEvents != null && Model.PlanEvents.Count() > 0)
                {
                    <table class="table table-bordered dt-responsive cm-table" id="tblcontainer">
                        <theader>
                            <tr>
                                <th>Event Name</th>
                                <th>Active</th>
                                <th>
                                    Success Event Emails
                                </th>
                                <th>
                                    Failure Event Emails
                                </th>
                            </tr>
                        </theader>

                        @for (int i = 0; i < Model.PlanEvents.Count(); i++)
                        {
                            <tbody id="ReplacingTable">

                                <tr id="tr_PlanEvents_@i">
                                    <td>
                                        <input id="PlanEvents_Id_@i" type="hidden" value="@Model.PlanEvents[i].Id" class="iHidden" name="PlanEvents[@i].Id" />
                                        <input id="PlanEvents_PlanId_@i" type="hidden" value="@Model.PlanEvents[i].PlanId" class="iHidden" name="PlanEvents[@i].PlanId" />
                                        <input id="PlanEvents_EventId_@i" type="hidden" value="@Model.PlanEvents[i].EventId" class="iHidden" name="PlanEvents[@i].EventId" />
                                        @*<input type="text" style="width:70px;" id="PlanAttributes[@i].DisplayName" name="PlanAttributes[@i].DisplayName" value="@Model.PlanAttributes[i].DisplayName" />*@
                                        @Model.PlanEvents[i].EventName
                                    </td>
                                    <td>
                                        @Html.CheckBoxFor(model => model.PlanEvents[i].Isactive, new { name = "PlanEvents[@i].Isactive", id = string.Format("PlanEvents_Isactive_{0}", @i) })
                                        @*<input type="checkbox" id="PlanEvents_IsEnabled_@i" name="PlanEvents[@i].IsEnabled" value="@Model.PlanEvents[i].IsEnabled" />*@
                                    </td>
                                    <td><input type="text" style="width:200px;" id="PlanEvents_SuccessStateEmails_@i" name="PlanEvents[@i].SuccessStateEmails" value="@Model.PlanEvents[i].SuccessStateEmails" /></td>
                                    <td><input type="text" style="width:200px;" id="PlanEvents_FailureStateEmails_@i" name="PlanEvents[@i].FailureStateEmails" value="@Model.PlanEvents[i].FailureStateEmails" /></td>
                                </tr>

                            </tbody>
                        }
                    </table>
                }
                <div>
                    <p>
                        <input class="cm-button-default mt0" type="submit" value="Save Events" />
                    </p>
                </div>
            </div>

        </div>
    </form>
</div>
<script>
    $(document).ready(function () {
        $('#PlanAttributes').show();
        $('#PlanEvents').hide();
    })
    function toggleActions(current, next) {
        $('#Plan' + current).show();
        $('#Plan' + next).hide();
    }

</script>
